Segment tree>Lazy propagation
Mathematics>Composition of operations
