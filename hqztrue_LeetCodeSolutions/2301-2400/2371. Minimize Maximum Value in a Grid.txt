build an implicit DAG, and greedily use topology sort. O(sort(nm)).

