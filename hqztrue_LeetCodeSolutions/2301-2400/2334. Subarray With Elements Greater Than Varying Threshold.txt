1. add the numbers in increasing order (using bucket sort with n buckets), use doubly linked list to maintain the size of connected components. O(n).
2. use monotone stack. O(n).

