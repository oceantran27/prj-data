topological sort. O(n+m+L).

