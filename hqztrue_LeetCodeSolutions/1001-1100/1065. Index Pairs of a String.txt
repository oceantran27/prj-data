AC automaton. O(n+m+|output|).

