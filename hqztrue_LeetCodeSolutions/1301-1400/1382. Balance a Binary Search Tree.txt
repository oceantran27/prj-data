flatten and rebuild. O(n).
