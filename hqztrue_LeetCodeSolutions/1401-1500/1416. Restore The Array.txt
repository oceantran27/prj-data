DP, use suffix tree to determine the range of the transitions. O(n).
