predecessor search+priority queue. O(n log log n).

