DP on an implicit trie. O(log n).
